{% extends "layout.html" %}

{% block title %}Badge Gallery - EduCare{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2><i class="fas fa-medal me-2 text-warning"></i>Badge Gallery</h2>
            <p class="text-muted">All available badges and achievements</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="{{ url_for('gamification_bp.leaderboard') }}" class="btn btn-outline-primary">
                <i class="fas fa-trophy me-1"></i> Back to Leaderboard
            </a>
        </div>
    </div>

    <!-- Badge Categories -->
    <div class="row">
        {% for badge_name, badge_info in badges.items() %}
        <div class="col-md-3 col-sm-6 mb-4">
            <div class="card h-100 badge-card">
                <div class="card-body text-center">
                    <!-- Badge Icon -->
                    <div class="badge-icon mb-3">
                        <i class="fas {{ badge_info.icon }} fa-4x" style="color: {{ badge_info.color }};"></i>
                    </div>
                    
                    <!-- Badge Name -->
                    <h5 class="card-title">{{ badge_name }}</h5>
                    
                    <!-- Badge Description -->
                    <p class="card-text text-muted small">{{ badge_info.description }}</p>
                    
                    <!-- Requirements -->
                    <div class="badge-requirement mb-3">
                        <small class="text-muted">
                            <strong>Requirement:</strong><br>
                            {{ badge_info.requirement }}
                        </small>
                    </div>
                    
                    <!-- Points -->
                    <div class="mb-2">
                        <span class="badge bg-primary">
                            <i class="fas fa-star me-1"></i>{{ badge_info.points }} points
                        </span>
                    </div>
                    
                    <!-- Earned Count -->
                    <div class="progress" style="height: 25px;">
                        {% set earned_count = badge_stats.get(badge_name, 0) %}
                        {% set total_students = badge_stats.values()|sum if badge_stats.values()|sum > 0 else 1 %}
                        {% set percentage = (earned_count / total_students * 100)|round|int %}
                        <div class="progress-bar bg-success" role="progressbar" 
                             style="width: {{ percentage }}%;" 
                             aria-valuenow="{{ earned_count }}" 
                             aria-valuemin="0" 
                             aria-valuemax="{{ total_students }}">
                            {{ earned_count }} students
                        </div>
                    </div>
                    <small class="text-muted">{{ percentage }}% earned this badge</small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Badge Statistics -->
    <div class="card mt-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Badge Statistics</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="stat-item text-center">
                        <i class="fas fa-medal fa-3x text-warning mb-2"></i>
                        <h3>{{ badges|length }}</h3>
                        <p class="text-muted">Total Badges Available</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-item text-center">
                        <i class="fas fa-award fa-3x text-success mb-2"></i>
                        <h3>{{ badge_stats.values()|sum }}</h3>
                        <p class="text-muted">Total Badges Earned</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-item text-center">
                        <i class="fas fa-trophy fa-3x text-info mb-2"></i>
                        {% set most_earned = badge_stats.items()|sort(attribute='1', reverse=True)|first %}
                        <h3>{{ most_earned[0] if most_earned else 'N/A' }}</h3>
                        <p class="text-muted">Most Earned Badge</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Badge Categories Info -->
    <div class="card mt-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>How to Earn Badges</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6><i class="fas fa-graduation-cap me-2 text-primary"></i>Academic Badges</h6>
                    <ul>
                        <li>High Achiever: Maintain high GPA</li>
                        <li>Perfect Attendance: No absences</li>
                        <li>Early Starter: Complete assignments early</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6><i class="fas fa-users me-2 text-success"></i>Engagement Badges</h6>
                    <ul>
                        <li>Active Participant: High class participation</li>
                        <li>Consistent Learner: Maintain learning streak</li>
                        <li>Helpful Peer: Help other students</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.badge-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 2px solid #e0e0e0;
}

.badge-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    border-color: #667eea;
}

.badge-icon {
    padding: 20px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    border-radius: 50%;
    width: 120px;
    height: 120px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.badge-requirement {
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.stat-item {
    padding: 20px;
}
</style>
{% endblock %}
